<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ReactHooks组件 | Start</title><meta name="keywords" content="react React"><meta name="author" content="Mrs.G"><meta name="copyright" content="Mrs.G"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="#目录 [TOC]  一、React Hook 介绍与环境搭建 Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性 在 React Conf 2018 上，Sophie Alpert 和 Dan Abramov 介绍了 Hook官方视频 建议观看官方文档,B站UP主其实也是照着官方文档敲了一遍,所以可以跟我一样,先">
<meta property="og:type" content="article">
<meta property="og:title" content="ReactHooks组件">
<meta property="og:url" content="https://gwlnigth.github.io/2022/12/29/reactHooks/index.html">
<meta property="og:site_name" content="Start">
<meta property="og:description" content="#目录 [TOC]  一、React Hook 介绍与环境搭建 Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性 在 React Conf 2018 上，Sophie Alpert 和 Dan Abramov 介绍了 Hook官方视频 建议观看官方文档,B站UP主其实也是照着官方文档敲了一遍,所以可以跟我一样,先">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/6o/wallhaven-6od3px.jpg">
<meta property="article:published_time" content="2022-12-29T10:07:43.401Z">
<meta property="article:modified_time" content="2022-12-29T10:08:47.378Z">
<meta property="article:author" content="Mrs.G">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/6o/wallhaven-6od3px.jpg"><link rel="shortcut icon" href="https://gitee.com/airgwl/upic/raw/master//img/favicon.png"><link rel="canonical" href="https://gwlnigth.github.io/2022/12/29/reactHooks/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":1,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ReactHooks组件',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-29 18:08:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/gwlnigth/upic/main/img/myher.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">129</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gulugulu/"><i class="fa-fw fas fa-link"></i><span> 叽里呱啦</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/6o/wallhaven-6od3px.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Start</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gulugulu/"><i class="fa-fw fas fa-link"></i><span> 叽里呱啦</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ReactHooks组件</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-29T10:07:43.401Z" title="发表于 2022-12-29 18:07:43">2022-12-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-29T10:08:47.378Z" title="更新于 2022-12-29 18:08:47">2022-12-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ReactHooks组件"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="目录"><a href="#目录" class="headerlink" title="#目录"></a>#目录</h1><blockquote>
<p>[TOC]</p>
</blockquote>
<h1 id="一、React-Hook-介绍与环境搭建"><a href="#一、React-Hook-介绍与环境搭建" class="headerlink" title="一、React Hook 介绍与环境搭建"></a>一、React Hook 介绍与环境搭建</h1><blockquote>
<p><em>Hook</em> 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性</p>
<p>在 React Conf 2018 上，Sophie Alpert 和 Dan Abramov 介绍了 Hook<a target="_blank" rel="noopener" href="https://youtu.be/dpw9EHDh2bM">官方视频</a></p>
<p>建议观看<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-intro.html">官方文档</a>,B站UP主其实也是照着官方文档敲了一遍,所以可以跟我一样,先看文档再去看UP敲一遍,自己在敲一遍,就基本会了</p>
<p>ps:讲真的 里面小哥哥挺帅的,我一不懂英语的愣是看着他听了半小时(本人男哈哈),这里也吐槽一下,好不容易习惯了class写法,结果这里可以弃用,很裂开</p>
</blockquote>
<h2 id="1、使用create-react-app创建项目"><a href="#1、使用create-react-app创建项目" class="headerlink" title="1、使用create-react-app创建项目"></a>1、使用<code>create-react-app</code>创建项目</h2><blockquote>
<p><code>create-react-app</code>它是React官方的脚手架，所以稳定性和使用率都是目前最好的，你可以大胆的进行使用。</p>
<blockquote>
<p>这里我在D盘新建一个<code>ReactHooksDemo</code>的文件夹，然后在文件夹中用<code>create-react-app</code>创建一个demo01的项目。我们这些动作全部在终端中进行。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D: // 进入D盘</span><br><span class="line">mkdir ReactHooksDemo</span><br><span class="line"><span class="built_in">cd</span> ReactHooksDemo</span><br><span class="line">create-react-app demo01</span><br></pre></td></tr></table></figure>

<p>只留<code>/src/index.js</code>文件，因为本处只要对比原生写法与hooks,然后把里边的代码删减成下面的样子:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>这样就算开发环境搭建完成了，接下来我们对比一下原始的写法和现在有了React Hooks的写法。</p>
</blockquote>
<h2 id="2、React-Hooks-编写形式对比"><a href="#2、React-Hooks-编写形式对比" class="headerlink" title="2、React Hooks 编写形式对比"></a>2、React Hooks 编写形式对比</h2><blockquote>
<p>先来写一个最简单的有状体组件，点我们点击按钮时，点击数量不断增加。官方提供的示例</p>
<h6 id="原始写法"><a href="#原始写法" class="headerlink" title="原始写法:"></a>原始写法:</h6><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123; <span class="attr">count</span>:<span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;this.state.count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.addCount.bind(this)&#125;</span>&gt;</span>Chlick me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">addCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>:<span class="built_in">this</span>.state.count+<span class="number">1</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example;</span><br></pre></td></tr></table></figure>

<h6 id="React-Hooks-写法："><a href="#React-Hooks-写法：" class="headerlink" title="React Hooks 写法："></a>React Hooks 写法：</h6><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example;</span><br></pre></td></tr></table></figure>

<p>从这两个程序的对比上可以看出Hooks本质上就是一类特殊的函数，他们可以为你的函数型组件（function component）注入一些特殊的功能。这听起来有点像以前React中的<code>Mixins</code>差不多哦。其实是由很多不同，hooks的目的就是让你不再写<code>class</code>，让<code>function</code>一统江湖。</p>
<blockquote>
<p>前面学的class可能咱不怎么用了以后</p>
</blockquote>
</blockquote>
<hr>
<h1 id="二、useState"><a href="#二、useState" class="headerlink" title="二、useState"></a>二、useState</h1><h2 id="1、useState的介绍"><a href="#1、useState的介绍" class="headerlink" title="1、useState的介绍"></a>1、useState的介绍</h2><blockquote>
<p><code>useState</code>是react自带的一个hook函数，它的作用是用来声明状态变量。</p>
<p>那我们从三个方面来看<code>useState</code>的用法，分别是声明、读取、使用（修改）。这三个方面掌握了，你基本也就会使用<code>useState</code>了.</p>
</blockquote>
<h3 id="Ⅰ-声明的方式"><a href="#Ⅰ-声明的方式" class="headerlink" title="Ⅰ - 声明的方式"></a>Ⅰ - 声明的方式</h3><blockquote>
<p>先来看一下声明的方式，上节的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>这种方法是ES6语法中的数组解构，这样看起来代码变的简单易懂。现在ES6的语法已经在工作中频繁使用，所以如果你对ES6的语法还不熟悉，我觉的有必要先去学习 –&gt;  <strong><a target="_blank" rel="noopener" href="https://gitee.com/hongjilin/hongs-study-notes/tree/master/%E7%BC%96%E7%A8%8B_%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ES6%E5%8F%8A%E5%90%8E%E7%BB%AD%E7%89%88%E6%9C%AC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">ES6及后续版本学习笔记</a></strong> 。 如果不写成数组解构，上边的语法要写成下面的三行:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">let</span> _useState = userState(<span class="number">0</span>)</span><br><span class="line">&gt;<span class="keyword">let</span> count = _useState[<span class="number">0</span>]</span><br><span class="line">&gt;<span class="keyword">let</span> setCount = _useState[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p><code>useState</code>这个函数接收的参数是状态的初始值(Initial state)，它返回一个数组</p>
<blockquote>
<ul>
<li>这个数组的第0位是当前的状态值，</li>
<li>第1位是可以改变状态值的方法函数。</li>
</ul>
</blockquote>
<p>所以上面的代码的意思就是声明了一个状态变量为count，并把它的初始值设为0，同时提供了一个可以改变<code>count</code>的状态值的方法函数</p>
</blockquote>
<h3 id="Ⅱ-如何读取状态中的值"><a href="#Ⅱ-如何读取状态中的值" class="headerlink" title="Ⅱ - 如何读取状态中的值"></a>Ⅱ - 如何读取状态中的值</h3><blockquote>
<p>这时候你已经会声明一个状态了，接下来我们看看如何读取状态中的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>你可以发现，我们读取是很简单的。只要使用<code>&#123;count&#125;</code>就可以，因为这时候的count就是JS里的一个变量，想在<code>JSX</code>中使用，值用加上<code>&#123;&#125;</code>就可以。</p>
<p>最后看看如果改变<code>State</code>中的值,看下面的代码:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

</blockquote>
<h3 id="Ⅲ-如何改变State的值"><a href="#Ⅲ-如何改变State的值" class="headerlink" title="Ⅲ - 如何改变State的值"></a>Ⅲ - 如何改变State的值</h3><blockquote>
<ul>
<li>直接调用setCount函数，这个函数接收的参数是修改过的新状态值。</li>
<li>接下来的事情就交给<code>React</code>,他会重新渲染组件。</li>
<li><code>React</code>自动帮助我们记忆了组件的上一次状态值</li>
<li>虽然这种记忆也给我们带来了一点小麻烦，但是这种麻烦你可以看成规则，只要准守规则，就可以愉快的进行编码。</li>
</ul>
</blockquote>
<h2 id="2、多状态声明的注意事项"><a href="#2、多状态声明的注意事项" class="headerlink" title="2、多状态声明的注意事项"></a>2、多状态声明的注意事项</h2><blockquote>
<p>比如现在我们要声明多个状态，有年龄（age）、性别(sex)和工作(work)。代码可以这么写.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ age , setAge ] = useState(<span class="number">18</span>)</span><br><span class="line">   <span class="keyword">const</span> [ sex , setSex ] = useState(<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line">   <span class="keyword">const</span> [ work , setWork ] = useState(<span class="string">&#x27;前端程序员&#x27;</span>)</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>JSPang 今年:&#123;age&#125;岁<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别:&#123;sex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>工作是:&#123;work&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example2;</span><br></pre></td></tr></table></figure>

<p>其实细心的小伙伴一定可以发现，在使用<code>useState</code>的时候只赋了初始值，并没有绑定任何的<code>key</code>,那React是怎么保证这三个useState找到它自己对应的state呢？</p>
<p><strong>答案是：<code>React是根据useState出现的顺序来确定的</code></strong></p>
</blockquote>
<h3 id="Ⅰ-举个错误写法"><a href="#Ⅰ-举个错误写法" class="headerlink" title="Ⅰ - 举个错误写法"></a>Ⅰ - 举个错误写法</h3><blockquote>
<p>比如我们把代码改成下面的样子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">let</span> showSex = <span class="literal">true</span></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ age , setAge ] = useState(<span class="number">18</span>)</span><br><span class="line">   <span class="keyword">if</span>(showSex)&#123;</span><br><span class="line">       <span class="keyword">const</span> [ sex , setSex ] = useState(<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line">       showSex=<span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> [ work , setWork ] = useState(<span class="string">&#x27;前端程序员&#x27;</span>)</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>JSPang 今年:&#123;age&#125;岁<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>性别:&#123;sex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>工作是:&#123;work&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example2;</span><br></pre></td></tr></table></figure>

<p>这时候控制台就会直接给我们报错，错误如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React Hook <span class="string">&quot;useState&quot;</span> is called conditionally. React Hooks must be called <span class="keyword">in</span> the exact same order <span class="keyword">in</span> every component render </span><br></pre></td></tr></table></figure>

<p>意思就是useState不能在<code>if...else...</code>这样的条件语句中进行调用，必须要按照相同的顺序进行渲染。如果你还是不理解，你可以记住这样一句话就可以了：<strong>就是React Hooks不能出现在条件判断语句中，因为它必须有完全一样的渲染顺序</strong>。</p>
</blockquote>
<hr>
<h1 id="三、useEffect"><a href="#三、useEffect" class="headerlink" title="三、useEffect"></a>三、useEffect</h1><h2 id="1、useEffect代替常用生命周期函数"><a href="#1、useEffect代替常用生命周期函数" class="headerlink" title="1、useEffect代替常用生命周期函数"></a>1、useEffect代替常用生命周期函数</h2><blockquote>
<p>在用<code>Class</code>制作组件时，经常会用生命周期函数，来处理一些额外的事情（副作用：和函数业务主逻辑关联不大，特定时间或事件中执行的动作，比如Ajax请求后端数据，添加登录监听和取消登录，手动修改<code>DOM</code>等等）。在<code>React Hooks</code>中也需要这样类似的生命周期函数，比如在每次状态（State）更新时执行，它为我们准备了<code>useEffect</code>。</p>
</blockquote>
<h3 id="Ⅰ-用Class的方式为计数器增加生命周期函数"><a href="#Ⅰ-用Class的方式为计数器增加生命周期函数" class="headerlink" title="Ⅰ - 用Class的方式为计数器增加生命周期函数"></a>Ⅰ - 用<code>Class</code>的方式为计数器增加生命周期函数</h3><blockquote>
<p>为了让你更好的理解<code>useEffect</code>的使用，先用原始的方式把计数器的Demo增加两个生命周期函数<code>componentDidMount</code>和<code>componentDidUpdate</code>。分别在组件第一次渲染后在浏览器控制台打印出计数器结果和在每次计数器状态发生变化后打印出结果。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&gt;<span class="class"><span class="keyword">class</span> <span class="title">Example3</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(props);</span><br><span class="line">       <span class="built_in">this</span>.state = &#123; <span class="attr">count</span>:<span class="number">0</span> &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">`ComponentDidMount=&gt;You clicked <span class="subst">$&#123;<span class="built_in">this</span>.state.count&#125;</span> times`</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">`componentDidUpdate=&gt;You clicked <span class="subst">$&#123;<span class="built_in">this</span>.state.count&#125;</span> times`</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123; </span><br><span class="line">       <span class="keyword">return</span> (</span><br><span class="line">           <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;this.state.count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.addCount.bind(this)&#125;</span>&gt;</span>Chlick me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">       );</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="title">addCount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">this</span>.setState(&#123;<span class="attr">count</span>:<span class="built_in">this</span>.state.count+<span class="number">1</span>&#125;)</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example3;</span><br></pre></td></tr></table></figure>

<p>这就是在不使用Hooks情况下的写法，那如何用Hooks来代替这段代码，并产生一样的效果那。</p>
</blockquote>
<h3 id="Ⅱ-用useEffect函数来代替生命周期函数"><a href="#Ⅱ-用useEffect函数来代替生命周期函数" class="headerlink" title="Ⅱ - 用useEffect函数来代替生命周期函数"></a>Ⅱ - 用<code>useEffect</code>函数来代替生命周期函数</h3><blockquote>
<p>在使用<code>React Hooks</code>的情况下，我们可以使用下面的代码来完成上边代码的生命周期效果，代码如下（修改了以前的diamond）： 记得要先引入<code>useEffect</code>后，才可以正常使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState , useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line">   <span class="comment">//---关键代码---------start-------</span></span><br><span class="line">   useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>)</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="comment">//---关键代码---------end-------</span></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>写完后，可以到浏览器中进行预览一下，可以看出跟<code>class</code>形式的生命周期函数是完全一样的，这代表第一次组件渲染和每次组件更新都会执行这个函数。</li>
<li> 那这段代码逻辑是什么？我们梳理一下:</li>
</ol>
<ul>
<li>首先，我们生命了一个状态变量<code>count</code>,将它的初始值设为0，然后我们告诉react，我们的这个组件有一个副作用。</li>
<li>给<code>useEffecthook</code>传了一个匿名函数，这个匿名函数就是我们的副作用。</li>
<li>在这里我们打印了一句话，当然你也可以手动的去修改一个<code>DOM</code>元素</li>
<li>当React要渲染组件时，它会记住用到的副作用，然后执行一次。</li>
<li>等Reat更新了State状态时，它再一词执行定义的副作用函数。</li>
</ul>
</blockquote>
</blockquote>
<h3 id="Ⅲ-useEffect两个注意点"><a href="#Ⅲ-useEffect两个注意点" class="headerlink" title="Ⅲ - useEffect两个注意点"></a>Ⅲ - useEffect两个注意点</h3><blockquote>
<ul>
<li>React首次渲染和之后的每次渲染都会调用一遍<code>useEffect</code>函数，而之前我们要用两个生命周期函数分别表示首次渲染(componentDidMonut)和更新导致的重新渲染(componentDidUpdate)。</li>
<li>useEffect中定义的函数的执行不会阻碍浏览器更新视图，也就是说这些函数时异步执行的，而<code>componentDidMonut</code>和<code>componentDidUpdate</code>中的代码都是同步执行的。个人认为这个有好处也有坏处吧，比如我们要根据页面的大小，然后绘制当前弹出窗口的大小，如果时异步的就不好操作了。</li>
</ul>
</blockquote>
<h2 id="2、useEffect-实现-componentWillUnmount生命周期函数"><a href="#2、useEffect-实现-componentWillUnmount生命周期函数" class="headerlink" title="2、useEffect 实现 componentWillUnmount生命周期函数"></a>2、useEffect 实现 componentWillUnmount生命周期函数</h2><blockquote>
<p>在写React应用的时候，在组件中经常用到<code>componentWillUnmount</code>生命周期函数（组件将要被卸载时执行）。比如我们的定时器要清空，避免发生内存泄漏;比如登录状态要取消掉，避免下次进入信息出错。所以这个生命周期函数也是必不可少的，这节笔记就来用<code>useEffect</code>来实现这个生命周期函数,并记录<code>useEffect</code>容易踩的坑。</p>
</blockquote>
<h3 id="Ⅰ-useEffect解绑副作用"><a href="#Ⅰ-useEffect解绑副作用" class="headerlink" title="Ⅰ - useEffect解绑副作用"></a>Ⅰ - useEffect解绑副作用</h3><h4 id="a-简单的栗子"><a href="#a-简单的栗子" class="headerlink" title="a)  简单的栗子"></a>a)  简单的栗子</h4><blockquote>
<p>通常，组件卸载时需要清除 effect 创建的诸如订阅或计时器 ID 等资源。要实现这⼀点， useEffect 函数需返回⼀个清除函数，以防⽌内存泄漏，清除函数会在组件卸载前执⾏。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   setDate(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"> &#125;, <span class="number">1000</span>);</span><br><span class="line"> <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&gt;&#125;, []);</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="b-复杂的栗子"><a href="#b-复杂的栗子" class="headerlink" title="b)  复杂的栗子"></a>b)  复杂的栗子</h4><blockquote>
<p>学习<code>React Hooks</code> 时，我们要改掉生命周期函数的概念（人往往有先入为主的毛病，所以很难改掉），因为<code>Hooks</code>叫它副作用，所以<code>componentWillUnmount</code>也可以理解成解绑副作用。</p>
</blockquote>
<h5 id="①-这里为了演示用useEffect来实现类似componentWillUnmount效果，先安装React-Router路由"><a href="#①-这里为了演示用useEffect来实现类似componentWillUnmount效果，先安装React-Router路由" class="headerlink" title="① 这里为了演示用useEffect来实现类似componentWillUnmount效果，先安装React-Router路由"></a>① 这里为了演示用<code>useEffect</code>来实现类似<code>componentWillUnmount</code>效果，先安装<code>React-Router</code>路由</h5><blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;npm install --save react-router-dom</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="②-然后打开Example-js文件-示例代码-，进行改写代码，先引入对应的React-Router组件。"><a href="#②-然后打开Example-js文件-示例代码-，进行改写代码，先引入对应的React-Router组件。" class="headerlink" title="② 然后打开Example.js文件(示例代码)，进行改写代码，先引入对应的React-Router组件。"></a>② 然后打开<code>Example.js</code>文件(示例代码)，进行改写代码，先引入对应的<code>React-Router</code>组件。</h5><blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="③-在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。"><a href="#③-在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。" class="headerlink" title="③ 在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。"></a>③ 在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。</h5><blockquote>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">List</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>List-Page<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>有了这两个组件后，接下来可以编写路由配置，在以前的计数器代码中直接增加就可以了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">return</span> (</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&gt;)</span><br></pre></td></tr></table></figure>

</blockquote>
<h5 id="④-然后到浏览器中查看一下"><a href="#④-然后到浏览器中查看一下" class="headerlink" title="④ 然后到浏览器中查看一下"></a>④ 然后到浏览器中查看一下</h5><blockquote>
<p>然后到浏览器中查看一下，看看组件和路由是否可用。如果可用，我们现在可以调整<code>useEffect</code>了。在两个新组件中分别加入<code>useEffect()</code>函数:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;useEffect=&gt;老弟，你来了！Index页面&#x27;</span>)</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">List</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;useEffect=&gt;老弟，你来了！List页面&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>List-Page<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们点击<code>Link</code>进入任何一个组件，在浏览器中都会打印出对应的一段话。这时候可以用<strong>返回一个函数的形式进行解绑</strong>，代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;useEffect=&gt;老弟你来了！Index页面&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;老弟，你走了!Index页面&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这时候你在浏览器中预览，我们仿佛实现了<code>componentWillUnmount</code>方法。但这只是好像实现了，当点击计数器按钮时，你会发现<code>老弟，你走了!Index页面</code>，也出现了。这到底是怎么回事那？其实每次状态发生变化，<code>useEffect</code>都进行了解绑。</p>
</blockquote>
</blockquote>
<h2 id="3、useEffect的第二个参数"><a href="#3、useEffect的第二个参数" class="headerlink" title="3、useEffect的第二个参数"></a>3、useEffect的第二个参数</h2><blockquote>
<p>那到底要如何实现类似<code>componentWillUnmount</code>的效果那?这就需要请出<code>useEffect</code>的第二个参数，它是一个数组，数组中可以写入很多状态对应的变量，意思是当状态值发生变化时，我们才进行解绑。但是当传空数组<code>[]</code>时，就是当组件将被销毁时才进行解绑，这也就实现了<code>componentWillUnmount</code>的生命周期函数。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;useEffect=&gt;老弟你来了！Index页面&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;老弟，你走了!Index页面&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,[])</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JSPang.com<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Ⅰ-举个栗子"><a href="#Ⅰ-举个栗子" class="headerlink" title="Ⅰ - 举个栗子"></a>Ⅰ - 举个栗子</h3><blockquote>
<p>为了更加深入了解第二个参数的作用，把计数器的代码也加上<code>useEffect</code>和解绑方法，并加入第二个参数为空数组。代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,[])</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>这时候的代码是不能执行解绑副作用函数的。但是如果我们想每次<code>count</code>发生变化，我们都进行解绑，只需要在第二个参数的数组里加入<code>count</code>变量就可以了。代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">`useEffect=&gt;You clicked <span class="subst">$&#123;count&#125;</span> times`</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,[count])</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                   <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/list/&quot;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/list/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>这时候只要<code>count</code>状态发生变化，都会执行解绑副作用函数，浏览器的控制台也就打印出了一串<code>=================</code>。</p>
</blockquote>
<h2 id="4、useEffect-的条件执⾏"><a href="#4、useEffect-的条件执⾏" class="headerlink" title="4、useEffect 的条件执⾏"></a>4、useEffect 的条件执⾏</h2><blockquote>
<ul>
<li>默认情况下，effect 会在每轮组件渲染完成后执⾏。这样的话，⼀旦 effect 的依赖发⽣变化，它就会被 重新创建。</li>
<li>然⽽，在某些场景下这么做可能会矫枉过正。</li>
<li>就比如我们不需要在每次组件 更新时都创建新的订阅，⽽是仅需要在 source props 改变时重新创建。 要实现这⼀点，可以给 useEffect 传递第⼆个参数，它是 effect 所依赖的值数组。更新后的示例如下</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HookPage</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// 声明⼀个叫 “count” 的 state 变量，初始化为0</span></span><br><span class="line"> <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line"> <span class="keyword">const</span> [date, setDate] = useState(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"> <span class="comment">// 与 componentDidMount 和 componentDidUpdate相似,每次count发生变化时触发</span></span><br><span class="line"> useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// 更新 title</span></span><br><span class="line">   <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</span><br><span class="line"> &#125;, [count]);</span><br><span class="line">&gt;<span class="comment">//如果只是要初始化运行一次,而不想被其他干扰,那么就可以另起一个useEffect </span></span><br><span class="line"> useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">     setDate(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">   &#125;, <span class="number">1000</span>);</span><br><span class="line"> &#125;, []);</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">h3</span>&gt;</span>HookPage<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;date.toLocaleTimeString()&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"> );</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>此时，只有当 useEffect第⼆个参数数组⾥的数值 改变后才会重新创建订阅。</p>
</blockquote>
<h2 id="5、清除-effect"><a href="#5、清除-effect" class="headerlink" title="5、清除 effect"></a>5、清除 effect</h2><blockquote>
<p>通常，组件卸载时需要清除 effect 创建的诸如订阅或计时器 ID 等资源。要实现这⼀点， useEffect 函数需返回⼀个清除函数，以防⽌内存泄漏，清除函数会在组件卸载前执⾏</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   setDate(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"> &#125;, <span class="number">1000</span>);</span><br><span class="line"> <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&gt;&#125;, []);</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="四、useContext"><a href="#四、useContext" class="headerlink" title="四、useContext"></a>四、useContext</h1><blockquote>
<blockquote>
<p><strong>useContext 让父子组件传值更简单 <code>Context</code>的作用就是对它所包含的组件树提供全局共享数据的一种技术。</strong></p>
</blockquote>
<p>有了<code>useState</code>和<code>useEffect</code>已经可以实现大部分的业务逻辑了，但是<code>React Hooks</code>中还是有很多好用的<code>Hooks</code>函数的，比如<code>useContext</code>和<code>useReducer</code>。</p>
<ol>
<li>在用类声明组件时，父子组件的传值是通过组件属性和<code>props</code>进行的，那现在使用方法(Function)来声明组件，已经没有了<code>constructor</code>构造函数也就没有了props的接收，那父子组件的传值就成了一个问题。</li>
<li><code>React Hooks</code> 为我们准备了<code>useContext</code>。它可以帮助我们跨越组件层级直接传递变量，实现共享。</li>
<li>需要注意的是<code>useContext</code>和<code>redux</code>的作用是不同的，</li>
</ol>
<ul>
<li>一个解决的是组件之间值传递的问题，</li>
<li>一个是应用中统一管理状态的问题，</li>
<li>但通过和<code>useReducer</code>的配合使用，可以实现类似<code>Redux</code>的作用。</li>
</ul>
<p>这就好比玩游戏时有很多英雄，英雄的最总目的都是赢得比赛，但是作用不同，有负责输出的，有负责抗伤害的，有负责治疗的。</p>
</blockquote>
<h2 id="1、useContext-介绍与代码示例"><a href="#1、useContext-介绍与代码示例" class="headerlink" title="1、useContext 介绍与代码示例"></a>1、useContext 介绍与代码示例</h2><blockquote>
<p>直接在<code>src</code>目录下新建一个文件<code>Example4.js</code>,然后拷贝<code>Example.js</code>里的代码，并进行修改，删除路由部分和副作用的代码，只留计数器的核心代码就可以了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState , useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example4</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example4;</span><br></pre></td></tr></table></figure>

<p>然后修改一下<code>index.js</code>让它渲染这个<code>Example4.js</code>组件，修改的代码如下。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line">&gt;<span class="keyword">import</span> Example <span class="keyword">from</span> <span class="string">&#x27;./Example4&#x27;</span></span><br><span class="line">&gt;ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Example</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>之后在<code>Example4.js</code>中引入<code>createContext</code>函数，并使用得到一个组件，然后在<code>return</code>方法中进行使用。先看代码，然后我再解释。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState , createContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="comment">//===关键代码</span></span><br><span class="line">&gt;<span class="keyword">const</span> CountContext = createContext()</span><br><span class="line"></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example4</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , setCount ] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setCount(count+1)&#125;&#125;&gt;click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">           &#123;/*======关键代码 将其注入子组件 */&#125;</span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">CountContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;count&#125;</span>&gt;</span> </span></span><br><span class="line"><span class="xml">               </span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">CountContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example4;</span><br></pre></td></tr></table></figure>

<p>这段代码就相当于把<code>count</code>变量允许跨层级实现传递和使用了（也就是实现了上下文），当父组件的<code>count</code>变量发生变化时，子组件也会发生变化。接下来我们就看看一个<code>React Hooks</code>的组件如何接收到这个变量。</p>
</blockquote>
<h2 id="2、useContext-接收上下文变量"><a href="#2、useContext-接收上下文变量" class="headerlink" title="2、useContext 接收上下文变量"></a>2、useContext 接收上下文变量</h2><blockquote>
<p>已经有了上下文变量，剩下的就时如何接收了，接收这个直接使用useContext就可以，但是在使用前需要新进行引入<code>useContext</code>（不引入是没办法使用的）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useState , createContext , useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>引入后写一个<code>Counter</code>组件，只是显示上下文中的<code>count</code>变量代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> count = useContext(CountContext)  <span class="comment">//一句话就可以得到count</span></span><br><span class="line">   <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>)</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<p>得到后就可以显示出来了，但是要记得在<code>&lt;CountContext.Provider&gt;</code>的闭合标签中,代码如下。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="xml"><span class="tag">&lt;<span class="name">CountContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;count&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span></span><br><span class="line"><span class="xml">&gt;<span class="tag">&lt;/<span class="name">CountContext.Provider</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

</blockquote>
<h1 id="五、useReducer介绍和简单使用"><a href="#五、useReducer介绍和简单使用" class="headerlink" title="五、useReducer介绍和简单使用"></a>五、useReducer介绍和简单使用</h1><blockquote>
<p>上节学习了<code>useContext</code>函数，那这节开始学习一下<code>useReducer</code>，因为他们两个很像，并且合作可以完成类似的Redux库的操作。在开发中使用<code>useReducer</code>可以让代码具有更好的可读性和可维护性，并且会给测试提供方便。</p>
</blockquote>
<h2 id="1、reducer到底是什么？"><a href="#1、reducer到底是什么？" class="headerlink" title="1、reducer到底是什么？"></a>1、reducer到底是什么？</h2><blockquote>
<p>为了更好的理解<code>useReducer</code>，所以先要了解JavaScript里的<code>Redcuer</code>是什么。</p>
<ul>
<li>它的兴起是从<code>Redux</code>广泛使用开始的，但不仅仅存在<code>Redux</code>中，可以使用JavaScript来完成<code>Reducer</code>操作。</li>
<li>那<code>reducer</code>其实就是一个函数，这个函数接收两个参数，一个是状态，一个用来控制业务逻辑的判断参数。</li>
<li>我们举一个最简单的例子。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countReducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;sub&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">default</span>: </span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码就是Reducer，你主要理解的就是这种形式和两个参数的作用，一个参数是状态，一个参数是如何控制状态。</p>
</blockquote>
<h2 id="2、useReducer的使用"><a href="#2、useReducer的使用" class="headerlink" title="2、useReducer的使用"></a>2、useReducer的使用</h2><blockquote>
<p>了解reducer的含义后，就可以讲useReducer了，它也是React hooks提供的函数，可以增强我们的<code>Reducer</code>，实现类似Redux的功能。我们新建一个<code>Example5.js</code>的文件，然后用useReducer实现计数器的加减双向操作。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">ReducerDemo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [ count , dispatch ] =useReducer(<span class="function">(<span class="params">state,action</span>)=&gt;</span>&#123;</span><br><span class="line">       <span class="keyword">switch</span>(action)&#123;</span><br><span class="line">           <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">               <span class="keyword">return</span> state+<span class="number">1</span></span><br><span class="line">           <span class="keyword">case</span> <span class="string">&#x27;sub&#x27;</span>:</span><br><span class="line">               <span class="keyword">return</span> state-<span class="number">1</span></span><br><span class="line">           <span class="attr">default</span>:</span><br><span class="line">               <span class="keyword">return</span> state</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,<span class="number">0</span>)</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>现在的分数是&#123;count&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>dispatch(&#x27;add&#x27;)&#125;&gt;Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>dispatch(&#x27;sub&#x27;)&#125;&gt;Decrement<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> ReducerDemo</span><br></pre></td></tr></table></figure>

<p>这段代码是useReducer的最简单实现了，这时候可以在浏览器中实现了计数器的增加减少。</p>
<p>修改<code>index.js</code>文件，让<code>ReducerDemo</code>组件起作用。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line">&gt;<span class="keyword">import</span> Example <span class="keyword">from</span> <span class="string">&#x27;./Example5&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Example</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

</blockquote>
<hr>
<h1 id="六、useReducer代替Redux小案例"><a href="#六、useReducer代替Redux小案例" class="headerlink" title="六、useReducer代替Redux小案例"></a>六、useReducer代替Redux小案例</h1><blockquote>
<p> 此处参考了掘金上缪宇的文章  –<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903854807482382">参考文章</a>,此处将其整理下来,方便查阅</p>
<p>未来我将会<code>尝试使用useReducer替代Mobx</code>状态管理器,并记录区别,但现在只是学习阶段,Mark一下</p>
</blockquote>
<h2 id="1、为何使用useReducer"><a href="#1、为何使用useReducer" class="headerlink" title="1、为何使用useReducer"></a>1、为何使用useReducer</h2><blockquote>
<h6 id="Redux-毫无疑问是众多-React-项目首选的状态管理方案，但-Redux-某些地方的开发体验并不好。"><a href="#Redux-毫无疑问是众多-React-项目首选的状态管理方案，但-Redux-某些地方的开发体验并不好。" class="headerlink" title="Redux 毫无疑问是众多 React 项目首选的状态管理方案，但 Redux 某些地方的开发体验并不好。"></a><strong>Redux 毫无疑问是众多 React 项目首选的状态管理方案，但 Redux 某些地方的开发体验并不好。</strong></h6><p>比如当你正在开发一个很复杂的功能，中途需要不断添加全局状态，每次添加都不得不重复如下步骤：</p>
<ol>
<li>去到管理 redux 的文件夹，思考把这个状态放到状态树的哪个位置，然后新建一个文件夹并命名 <code>myFeature</code>。</li>
<li>创建三个文件 <code>my-feature/actions.js</code> 、<code>my-feature/reducer.js</code>、<code>my-feature/type.js</code></li>
<li>combineReducer 和并 reduce</li>
<li>将 action 引入到组件中</li>
<li>通过 connect HOC 与你的组件相连</li>
<li>增加两个方法 mapStateToProps 和 mapDispatchToProps</li>
</ol>
<p>以上只是加个状态而已，写很多模板代码还是其次，最要命的是会打断你写代码的思路。</p>
<p>而且随着项目越来越大， redux 的状态树也会变大，维护也会变困难。</p>
</blockquote>
<h2 id="2、useContext-useReducer-如何替代-redux-？及可行性"><a href="#2、useContext-useReducer-如何替代-redux-？及可行性" class="headerlink" title="2、useContext + useReducer 如何替代 redux ？及可行性"></a>2、useContext + useReducer 如何替代 redux ？及可行性</h2><blockquote>
<p><code>useContext</code> 和 <code>useReducer</code> 是 React 16.8 引入的新 API。</p>
<p><code>useContext</code>：可访问全局状态，避免一层层的传递状态。这符合<code>Redux</code>其中的一项规则，就是状态全局化，并能统一管理。</p>
<p><code>useReducer</code>：通过action的传递，更新复杂逻辑的状态，主要是可以实现类似<code>Redux</code>中的<code>Reducer</code>部分，实现业务逻辑的可行性。</p>
</blockquote>
<h2 id="3、案例代码示例"><a href="#3、案例代码示例" class="headerlink" title="3、案例代码示例"></a>3、案例代码示例</h2><h5 id="Ⅰ、开始"><a href="#Ⅰ、开始" class="headerlink" title="Ⅰ、开始"></a>Ⅰ、开始</h5><blockquote>
<p>首先用 create-react-app 创建一个项目</p>
</blockquote>
<h5 id="Ⅱ、创建颜色展示组件-ShowArea"><a href="#Ⅱ、创建颜色展示组件-ShowArea" class="headerlink" title="Ⅱ、创建颜色展示组件 ShowArea"></a>Ⅱ、创建颜色展示组件 ShowArea</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ShowArea = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> &quot;<span class="attr">blue</span>&quot;&#125;&#125;&gt;</span>字体颜色展示为blue<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ShowArea</span><br></pre></td></tr></table></figure>

<h5 id="Ⅲ、创建按钮组件-buttons"><a href="#Ⅲ、创建按钮组件-buttons" class="headerlink" title="Ⅲ、创建按钮组件 buttons"></a>Ⅲ、创建按钮组件 buttons</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Buttons = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>黄色<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Buttons;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅳ、将-ShowArea-和-Buttons-导入-index-js-等会写出color状态组件后将会改写"><a href="#Ⅳ、将-ShowArea-和-Buttons-导入-index-js-等会写出color状态组件后将会改写" class="headerlink" title="Ⅳ、将 ShowArea 和 Buttons 导入 index.js(等会写出color状态组件后将会改写)"></a>Ⅳ、将 ShowArea 和 Buttons 导入 index.js(等会写出color状态组件后将会改写)</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ShowArea <span class="keyword">from</span> <span class="string">&#x27;./ShowArea&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Buttons <span class="keyword">from</span> <span class="string">&#x27;./Buttons&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ShowArea</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Button</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅴ、状态管理组件创建编写"><a href="#Ⅴ、状态管理组件创建编写" class="headerlink" title="Ⅴ、状态管理组件创建编写"></a>Ⅴ、<code>状态管理</code>组件创建编写</h5><blockquote>
<p>很明显 ShowArea 组件需要一个颜色状态，所以我们创建 color.js 来处理状态。 <code>&#123;props.children&#125;</code>传值给子组件(多个)</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// color.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; createContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 context</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ColorContext = createContext(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个 Color 组件</span></span><br><span class="line"><span class="comment"> * Color 组件包裹的所有子组件都可以通过调用 ColorContext 访问到 value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Color = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ColorContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">blue</span>&quot; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ColorContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅵ、引入状态"><a href="#Ⅵ、引入状态" class="headerlink" title="Ⅵ、引入状态"></a>Ⅵ、引入状态</h5><blockquote>
<p>修改 index.js，让所有子组件都可以访问到颜色。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Color &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Color</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ShowArea</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Buttons</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Color</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅶ、获取状态"><a href="#Ⅶ、获取状态" class="headerlink" title="Ⅶ、获取状态"></a>Ⅶ、获取状态</h5><blockquote>
<p>在 ShowArea 组件中获取颜色 直接引入  然后使用<code>useContext</code>进行获取使用</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShowArea.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ColorContext &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ShowArea = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; color &#125; = useContext(ColorContext);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> <span class="attr">color</span> &#125;&#125;&gt;</span>字体颜色展示为&#123;color&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅷ、创建-reducer"><a href="#Ⅷ、创建-reducer" class="headerlink" title="Ⅷ、创建 reducer"></a>Ⅷ、<code>创建 reducer</code></h5><p>接着在 color.js 中添加 reducer， 用于处理颜色更新的逻辑。 然后使用<code>useReducer</code>传入reducer进行处理</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; createContext, useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 创建 context</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ColorContext = createContext(&#123;&#125;);</span><br><span class="line"><span class="comment">//声明常量是方便使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_COLOR = <span class="string">&quot;UPDATE_COLOR&quot;</span></span><br><span class="line"><span class="comment">// reducer方法 声明</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> UPDATE_COLOR:</span><br><span class="line">      <span class="keyword">return</span> action.color</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个 Color 组件</span></span><br><span class="line"><span class="comment"> * Color 组件包裹的所有组件都可以访问到 value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Color = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [color, dispatch] = useReducer(reducer, <span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ColorContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color,</span> <span class="attr">dispatch</span>&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ColorContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Ⅸ、更新状态"><a href="#Ⅸ、更新状态" class="headerlink" title="Ⅸ、更新状态"></a>Ⅸ、更新状态</h5><p>为按钮添加点击事件，调用 dispatch 就可以更新颜色了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buttons.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; colorContext, UPDATE_COLOR &#125; <span class="keyword">from</span> <span class="string">&quot;./color&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Buttons = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; dispatch &#125; = useContext(colorContext);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">          dispatch(&#123; type: UPDATE_COLOR, color: &quot;red&quot; &#125;);</span></span><br><span class="line"><span class="xml">        &#125;&#125;</span></span><br><span class="line"><span class="xml">      &gt;</span></span><br><span class="line"><span class="xml">        红色</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">          dispatch(&#123; type: UPDATE_COLOR, color: &quot;yellow&quot; &#125;);</span></span><br><span class="line"><span class="xml">        &#125;&#125;</span></span><br><span class="line"><span class="xml">      &gt;</span></span><br><span class="line"><span class="xml">        黄色</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Buttons;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h2><blockquote>
<ul>
<li>useContext 创建全局状态，不用一层一层的传递状态。</li>
<li>useReducer 创建 reducer 根据不同的 dispatch 更新 state。</li>
<li>代码写到哪里状态就加到哪里，不用打断思路跳到 redux 里面去写。</li>
<li>全局状态分离，避免项目变大导致 Redux 状态树难以管理。</li>
</ul>
<p>所以 useContext + useReducer 完全可以替代 React 进行状态管理。但是目前绝大多数 React 项目仍在使用 Redux，所以深入学习 Redux 还是很有必要的。</p>
</blockquote>
<hr>
<h1 id="七、useMemo优化React-Hooks程序性能"><a href="#七、useMemo优化React-Hooks程序性能" class="headerlink" title="七、useMemo优化React Hooks程序性能"></a>七、useMemo优化React Hooks程序性能</h1><blockquote>
<p><code>useMemo</code>主要用来解决使用React hooks产生的无用渲染的性能问题。使用function的形式来声明组件，失去了<code>shouldCompnentUpdate</code>（在组件更新之前）这个生命周期，也就是说我们没有办法通过组件更新前条件来决定组件是否更新。而且在函数组件中，也不再区分<code>mount</code>和<code>update</code>两个状态，这意味着函数组件的每一次调用都会执行内部的所有逻辑，就带来了非常大的性能损耗。<code>useMemo</code>和<code>useCallback</code>都是解决上述性能问题的</p>
</blockquote>
<h2 id="1、性能问题展示案例"><a href="#1、性能问题展示案例" class="headerlink" title="1、性能问题展示案例"></a>1、性能问题展示案例</h2><blockquote>
<p>先编写一下刚才所说的性能问题，建立两个组件,一个父组件一个子组件，组件上由两个按钮，一个是小洪，一个是帅洪，点击哪个，那个就像我们走来了。在<code>/src</code>文件夹下，新建立一个<code>Example7</code>的文件夹，在文件夹下建立一个<code>Example7.js</code>文件.然后先写第一个父组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123;useState,useMemo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example7</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [xiaohong , setXiaohong] = useState(<span class="string">&#x27;小洪待客状态&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> [zhiling , setZhiling] = useState(<span class="string">&#x27;帅洪待客状态&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setXiaohong(new Date().getTime())&#125;&#125;&gt;小洪<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;setZhiling(new Date().getTime()+&#x27;,帅洪向我们走来了&#x27;)&#125;&#125;&gt;洪帅<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">name</span>=<span class="string">&#123;xiaohong&#125;</span>&gt;</span>&#123;zhiling&#125;<span class="tag">&lt;/<span class="name">ChildComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>父组件调用了子组件，子组件我们输出两个人的状态，显示在界面上。代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChildComponent</span>(<span class="params">&#123;name,children&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeXiaohong</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;她来了，她来了。小洪向我们走来了&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> name+<span class="string">&#x27;,小洪向我们走来了&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> actionXiaohong = changeXiaohong(name)<span class="comment">//如果此组件重新渲染,就会执行函数,导致多次打印</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;actionXiaohong&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再导出父组件，让<code>index.js</code>可以渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example7</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>这时候你会发现在浏览器中点击<code>帅洪</code>按钮</li>
<li>小红对应的方法都会执行，结果虽然没变，但是每次都执行，这就是性能的损耗。</li>
<li>目前只有子组件，业务逻辑也非常简单，如果是一个后台查询，这将产生严重的后果。所以这个问题必须解决。</li>
<li>我们需要做到: 当我们点击<code>帅洪</code>按钮时，小洪对应的<code>changeXiaohong</code>方法不能执行，只有在点击<code>小洪</code>按钮时才能执行。</li>
</ul>
</blockquote>
</blockquote>
<h2 id="2、useMemo-优化性能"><a href="#2、useMemo-优化性能" class="headerlink" title="2、useMemo 优化性能"></a>2、useMemo 优化性能</h2><blockquote>
<p>其实只要使用<code>useMemo</code>，然后给她传递第二个参数，参数匹配成功，才会执行。代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">ChildComponent</span>(<span class="params">&#123;name,children&#125;</span>)</span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">changeXiaohong</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;她来了，她来了。小洪向我们走来了&#x27;</span>)</span><br><span class="line">       <span class="keyword">return</span> name+<span class="string">&#x27;,小洪向我们走来了&#x27;</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> actionXiaohong = useMemo(<span class="function">()=&gt;</span>changeXiaohong(name),[name]) </span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;actionXiaohong&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这时在浏览器中点击一下<code>帅洪</code>按钮，<code>changeXiaohong</code>就不再执行了。</li>
<li>也节省了性能的消耗。案例只是让你更好理解，你还要从程序本身看到优化的作用。</li>
<li>好的程序员对自己写的程序都是会进行不断优化的，这种没必要的性能浪费也是绝对不允许的，所以<code>useMemo</code>的使用在工作中还是比较多的。</li>
</ul>
</blockquote>
<h2 id="3、可能遇到的坑"><a href="#3、可能遇到的坑" class="headerlink" title="3、可能遇到的坑"></a>3、可能遇到的坑</h2><h3 id="Ⅰ-传递的第二个参数使用赋值解构"><a href="#Ⅰ-传递的第二个参数使用赋值解构" class="headerlink" title="Ⅰ - 传递的第二个参数使用赋值解构"></a>Ⅰ - 传递的第二个参数使用赋值解构</h3><blockquote>
<h6 id="错误代码"><a href="#错误代码" class="headerlink" title="错误代码"></a>错误代码</h6><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> data = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(test,<span class="string">&quot;触发&quot;</span>)</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">       <span class="attr">test</span>: test + <span class="string">&quot;onChange&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;,&#123;...test&#125;) <span class="comment">//此处错误,不能用赋值解构方式</span></span><br></pre></td></tr></table></figure>

<p>可能有同学ES6用习惯了,喜欢用赋值解构方式,想说实现 <strong>test对象中某一属性发生变化</strong> 是触发,就直接这样写了,但实际上,这样写的话每次传入的都是一个新的对象,会导致 <strong>useMemo</strong> 没有效果</p>
<h6 id="正确的写法"><a href="#正确的写法" class="headerlink" title="正确的写法"></a>正确的写法</h6><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> data = useMemo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(test,<span class="string">&quot;触发&quot;</span>)</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">       <span class="attr">test</span>: test + <span class="string">&quot;onChange&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;,&#123;test&#125;) <span class="comment">//直接变量写入即可</span></span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h1 id="八、useRef获取DOM元素和保存变量"><a href="#八、useRef获取DOM元素和保存变量" class="headerlink" title="八、useRef获取DOM元素和保存变量"></a>八、useRef获取DOM元素和保存变量</h1><blockquote>
<p><code>useRef</code>在工作中虽然用的不多，但是也不能缺少。它有两个主要的作用:</p>
<ul>
<li>用<code>useRef</code>获取React JSX中的DOM元素，获取后你就可以控制DOM的任何东西了。但是一般不建议这样来作，React界面的变化可以通过状态来控制。</li>
<li>用<code>useRef</code>来保存变量，这个在工作中也很少能用到，我们有了<code>useContext</code>这样的保存其实意义不大</li>
</ul>
</blockquote>
<h2 id="1、useRef获取DOM元素"><a href="#1、useRef获取DOM元素" class="headerlink" title="1、useRef获取DOM元素"></a>1、useRef获取DOM元素</h2><blockquote>
<p>比如一个案例,想象一下:界面上有一个文本框，在文本框的旁边有一个按钮，当我们点击按钮时，在控制台打印出<code>input</code>的DOM元素，并进行复制到DOM中的value上。这一切都是通过<code>useRef</code>来实现。</p>
<p>在<code>/src</code>文件夹下新建一个<code>Example8.js</code>文件，然后先引入useRef，编写业务逻辑代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example8</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> inputEl = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> onButtonClick=<span class="function">()=&gt;</span>&#123; </span><br><span class="line">        inputEl.current.value=<span class="string">&quot;Hello ,JSPang&quot;</span></span><br><span class="line">        <span class="built_in">console</span>.log(inputEl) <span class="comment">//输出获取到的DOM节点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span> = <span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example8</span><br></pre></td></tr></table></figure>

<p>当点击按钮时，你可以看到在浏览器中的控制台完整的打印出了DOM的所有东西，并且界面上的<code>&lt;input/&gt;</code>框的value值也输出了我们写好的<code>Hello ,JSPang</code>。这一切说明我们可以使用useRef获取DOM元素，并且可以通过useRefu控制DOM的属性和值。</p>
</blockquote>
<h2 id="2、useRef保存普通变量"><a href="#2、useRef保存普通变量" class="headerlink" title="2、useRef保存普通变量"></a>2、useRef保存普通变量</h2><blockquote>
<p>这个操作在实际开发中用的并不多，但我们还是要讲解一下。就是<code>useRef</code>可以保存React中的变量。我们这里就写一个文本框，文本框用来改变<code>text</code>状态。又用<code>useRef</code>把<code>text</code>状态进行保存，最后打印在控制台上。写这段代码你会觉的很绕，其实显示开发中没必要这样写，用一个state状态就可以搞定，这里只是为了展示知识点。</p>
<p>接着上面的代码来写，就没必要重新写一个文件了。先用<code>useState</code>声明了一个<code>text</code>状态和<code>setText</code>函数。然后编写界面，界面就是一个文本框。然后输入的时候不断变化。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef ,useState,useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example8</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> inputEl = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> onButtonClick=<span class="function">()=&gt;</span>&#123; </span><br><span class="line">        inputEl.current.value=<span class="string">&quot;Hello ,useRef&quot;</span></span><br><span class="line">        <span class="built_in">console</span>.log(inputEl)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> [text, setText] = useState(<span class="string">&#x27;jspang&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span> = <span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;setText(e.target.value)&#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example8</span><br></pre></td></tr></table></figure>

<p>这时想每次<code>text</code>发生状态改变，保存到一个变量中或者说是<code>useRef</code>中，这时候就可以使用<code>useRef</code>了。先声明一个<code>textRef</code>变量，他其实就是<code>useRef</code>函数。然后使用<code>useEffect</code>函数实现每次状态变化都进行变量修改，并打印。最后的全部代码如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef ,useState,useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example8</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> inputEl = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> onButtonClick=<span class="function">()=&gt;</span>&#123; </span><br><span class="line">        inputEl.current.value=<span class="string">&quot;Hello ,useRef&quot;</span></span><br><span class="line">        <span class="built_in">console</span>.log(inputEl)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//-----------关键代码--------start</span></span><br><span class="line">    <span class="keyword">const</span> [text, setText] = useState(<span class="string">&#x27;jspang&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> textRef = useRef()</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        textRef.current = text;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;textRef.current:&#x27;</span>, textRef.current)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//----------关键代码--------------end</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/*保存input的ref到inputEl */&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span> = <span class="string">&#123;onButtonClick&#125;</span>&gt;</span>在input上展示文字<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;text&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;setText(e.target.value)&#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example8</span><br></pre></td></tr></table></figure>

<p>这时候就可以实现每次状态修改，同时保存到<code>useRef</code>中了。也就是我们说的保存变量的功能。那<code>useRef</code>的主要功能就是获得DOM和变量保存，我们都已经讲过了。</p>
</blockquote>
<hr>
<h1 id="九、自定义Hooks函数获取窗口大小"><a href="#九、自定义Hooks函数获取窗口大小" class="headerlink" title="九、自定义Hooks函数获取窗口大小"></a>九、自定义Hooks函数获取窗口大小</h1><blockquote>
<p>其实自定义Hooks函数和用Hooks创建组件很相似，跟我们平时用JavaScript写函数几乎一模一样，可能就是多了些<code>React Hooks</code>的特性，自定义Hooks函数偏向于功能，而组件偏向于界面和业务逻辑。由于差别不大，所以使用起来也是很随意的。如果是小型项目是可以的，但是如果项目足够复杂，这会让项目结构不够清晰。所以学习自定义Hooks函数还是很有必要的。</p>
</blockquote>
<h2 id="1、编写自定义函数"><a href="#1、编写自定义函数" class="headerlink" title="1、编写自定义函数"></a>1、编写自定义函数</h2><blockquote>
<p>在实际开发中，为了界面更加美观。获取浏览器窗口的尺寸是一个经常使用的功能，这样经常使用的功能，就可以封装成一个自定义<code>Hooks</code>函数，记住一定要用use开头，这样才能区分出什么是组件，什么是自定义函数。</p>
<p>新建一个文件<code>Example9.js</code>,然后编写一个useWinSize,编写时我们会用到<code>useState</code>、<code>useEffect</code>和<code>useCallback</code>所以先用<code>import</code>进行引入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState ,useEffect ,useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>然后编写函数，函数中先用useState设置<code>size</code>状态</li>
<li>然后编写一个每次修改状态的方法<code>onResize</code>,这个方法使用<code>useCallback</code>，目的是为了缓存方法(useMemo是为了缓存变量)。</li>
<li> 然后在第一次进入方法时用<code>useEffect</code>来注册<code>resize</code>监听时间。</li>
<li>为了防止一直监听所以在方法移除时，使用return的方式移除监听。最后返回size变量就可以了。</li>
</ul>
<p><code>resize</code>  浏览器窗口被调整到一个新的高度或宽度时，就会触发resize事件,这是js监听事件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useWinSize</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [ size , setSize] = useState(&#123;</span><br><span class="line">        <span class="attr">width</span>:<span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">        <span class="attr">height</span>:<span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> onResize = useCallback(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setSize(&#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="built_in">document</span>.documentElement.clientWidth,</span><br><span class="line">            <span class="attr">height</span>: <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,[]) </span><br><span class="line">    useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        &#123;<span class="comment">/*  resize  浏览器窗口被调整到一个新的高度或宽度时，就会触发resize事件*/</span>&#125;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;resize&#x27;</span>,onResize)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;resize&#x27;</span>,onResize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,[])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是一个自定义函数，其实和我们以前写的JS函数没什么区别，所以这里也不做太多的介绍。</p>
</blockquote>
<h2 id="2、编写组件并使用自定义函数"><a href="#2、编写组件并使用自定义函数" class="headerlink" title="2、编写组件并使用自定义函数"></a>2、编写组件并使用自定义函数</h2><blockquote>
<p>自定义<code>Hooks</code>函数已经写好了，可以直接进行使用，用法和<code>JavaScript</code>的普通函数用起来是一样的。直接在<code>Example9</code>组件使用<code>useWinSize</code>并把结果实时展示在页面上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="function"><span class="keyword">function</span> <span class="title">Example9</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> size = useWinSize()</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">       <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>页面Size:&#123;size.width&#125;x&#123;size.height&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> Example9 </span><br></pre></td></tr></table></figure>

<p>之后就可以在浏览器中预览一下结果，可以看到当我们放大缩小浏览器窗口时，页面上的结果都会跟着进行变化。说明自定义的函数起到了作用。</p>
</blockquote>
<h1 id="十、React的React-FC与React-Component的初步认识"><a href="#十、React的React-FC与React-Component的初步认识" class="headerlink" title="十、React的React.FC与React.Component的初步认识"></a>十、React的React.FC与React.Component的初步认识</h1><blockquote>
<ul>
<li><p>即<code>Hooks</code>与<code>Component</code></p>
</li>
<li><p>正常来讲,尽量使用<code> React.FC</code></p>
</li>
</ul>
</blockquote>
<h2 id="1、React-FC-lt-gt"><a href="#1、React-FC-lt-gt" class="headerlink" title="1、React.FC&lt;&gt;"></a>1、React.FC&lt;&gt;</h2><blockquote>
<ol>
<li><code>React.FC</code>是函数式组件，是在TypeScript使用的一个泛型，FC就是FunctionComponent的缩写，事实上<code>React.FC</code>可以写成<code>React.FunctionComponent</code>：</li>
</ol>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">const</span> App: React.FunctionComponent&lt;&#123; <span class="attr">message</span>: string &#125;&gt; = <span class="function">(<span class="params">&#123; message &#125;</span>) =&gt;</span> (</span><br><span class="line"> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&gt;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>React.FC 包含了 PropsWithChildren 的泛型，不用显式的声明 props.children 的类型。React.FC&lt;&gt; 对于返回类型是显式的，而普通函数版本是隐式的（否则需要附加注释）。</p>
</li>
<li><p>React.FC提供了类型检查和自动完成的静态属性：displayName，propTypes和defaultProps（注意：defaultProps与React.FC结合使用会存在一些问题）。</p>
</li>
<li><p>我们使用React.FC来写 React 组件的时候，是<code>不能用setState</code>的，取而代之的是useState()、useEffect等 Hook API。</p>
</li>
</ol>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;----------------------- 使用方法<span class="number">1</span> ----------------------------------------</span><br><span class="line">&gt;<span class="keyword">const</span> SampleModel: React.FC&lt;&#123;&#125;&gt; = <span class="function">() =&gt;</span>&#123;   <span class="comment">//React.FC&lt;&gt;为typescript使用的泛型</span></span><br><span class="line">  <span class="keyword">const</span> [createModalVisible, handleModalVisible] = useState&lt;boolean&gt;(<span class="literal">false</span>); </span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">  &#123;<span class="comment">/** 触发模态框**/</span>&#125;</span><br><span class="line">  &lt;Button style=&#123;&#123;<span class="attr">fontSize</span>:<span class="string">&#x27;25px&#x27;</span>&#125;&#125;  onClick=&#123;<span class="function">()=&gt;</span>handleModalVisible(<span class="literal">true</span>)&#125; &gt;样例&lt;/Button&gt;</span><br><span class="line">  &#123;<span class="comment">/** 模态框组件**/</span>&#125;</span><br><span class="line">  &lt;Model onCancel=&#123;<span class="function">() =&gt;</span> handleModalVisible(<span class="literal">false</span>)&#125; ModalVisible=&#123;createModalVisible&#125; /&gt; </span><br><span class="line"> &#125;</span><br><span class="line">&gt;------------------------- 使用方法<span class="number">2</span> ----------------------------------------------</span><br><span class="line">&gt;<span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">&gt;<span class="keyword">import</span> &#123; observer, useLocalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;mobx-react&#x27;</span>; <span class="comment">//引入mobx状态管理器</span></span><br><span class="line">&gt;<span class="comment">//组件    </span></span><br><span class="line">&gt;<span class="keyword">const</span> ChannelManager: FC = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> store = useLocalStore&lt;Store&gt;(<span class="function">() =&gt;</span> <span class="keyword">new</span> Store());</span><br><span class="line">   .....</span><br><span class="line">&gt;&#125;</span><br><span class="line">&gt;<span class="keyword">export</span> <span class="keyword">default</span> observer(ChannelManager);</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="2、class-xx-extends-React-Component"><a href="#2、class-xx-extends-React-Component" class="headerlink" title="2、class xx extends React.Component"></a>2、class xx extends React.Component</h2><blockquote>
<p>如需定义 class 组件，需要继承 React.Component。React.Component是类组件，在TypeScript中，React.Component是通用类型（aka React.Component&lt;PropType, StateType&gt;），因此要为其提供（可选）prop和state类型参数：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="class"><span class="keyword">class</span> <span class="title">SampleModel</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"> state = &#123;  <span class="attr">createModalVisible</span>:<span class="literal">false</span>, &#125;;</span><br><span class="line"> handleModalVisible =<span class="function">(<span class="params">cVisible:boolean</span>)=&gt;</span>&#123; <span class="built_in">this</span>.setState(&#123;<span class="attr">createModalVisible</span>:cVisible&#125;);&#125;;</span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line"> &#123;<span class="comment">/** 触发模态框**/</span>&#125;</span><br><span class="line">  &lt;Button onClick=&#123;<span class="function">()=&gt;</span><span class="built_in">this</span>.handleModalVisible(<span class="literal">true</span>)&#125; &gt;样例&lt;/Button&gt;</span><br><span class="line">  &#123;<span class="comment">/** 模态框组件**/</span>&#125;</span><br><span class="line">  &lt;Model onCancel=&#123;<span class="function">() =&gt;</span> handleModalVisible(<span class="literal">false</span>)&#125; ModalVisible=&#123;<span class="built_in">this</span>.state.createModalVisible&#125; /&gt; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Mrs.G</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gwlnigth.github.io/2022/12/29/reactHooks/">https://gwlnigth.github.io/2022/12/29/reactHooks/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gwlnigth.github.io" target="_blank">Start</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-615ab34ddc158b07" async="async"></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://raw.githubusercontent.com/gwlnigth/upic/main/img/weixin.png" target="_blank"><img class="post-qr-code-img" src="https://raw.githubusercontent.com/gwlnigth/upic/main/img/weixin.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://raw.githubusercontent.com/gwlnigth/upic/main/img/zhifubao.png" target="_blank"><img class="post-qr-code-img" src="https://raw.githubusercontent.com/gwlnigth/upic/main/img/zhifubao.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/29/react%E3%80%90react%E5%85%A5%E9%97%A8%E3%80%91/"><img class="prev-cover" src="https://w.wallhaven.cc/full/wq/wallhaven-wqdlq7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">React简介</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/08/React%E5%9F%BA%E7%A1%80/"><img class="next-cover" src="https://w.wallhaven.cc/full/wq/wallhaven-wqdlq7.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">React基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/08/React%E5%9F%BA%E7%A1%80/" title="React基础"><img class="cover" src="https://w.wallhaven.cc/full/wq/wallhaven-wqdlq7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-08</div><div class="title">React基础</div></div></a></div><div><a href="/2022/12/29/react%20%E3%80%90%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87%E3%80%91/" title="React状态提升"><img class="cover" src="https://w.wallhaven.cc/full/28/wallhaven-281d5y.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-29</div><div class="title">React状态提升</div></div></a></div><div><a href="/2022/12/29/react%20%E3%80%90%E7%BB%84%E5%90%88%E7%BB%84%E4%BB%B6%E3%80%91/" title="React组合组件"><img class="cover" src="https://w.wallhaven.cc/full/g7/wallhaven-g75r7d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-29</div><div class="title">React组合组件</div></div></a></div><div><a href="/2022/12/29/react%20%E3%80%90%E9%9D%A2%E5%90%91%E7%BB%84%E4%BB%B6%E7%BC%96%E7%A8%8B%E3%80%91/" title="React面向组件编程"><img class="cover" src="https://w.wallhaven.cc/full/rd/wallhaven-rdpgxj.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-29</div><div class="title">React面向组件编程</div></div></a></div><div><a href="/2022/12/29/react%E3%80%90Redux%20Toolkit%E3%80%91/" title="ReactRedux Toolkit"><img class="cover" src="https://w.wallhaven.cc/full/57/wallhaven-57mk71.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-29</div><div class="title">ReactRedux Toolkit</div></div></a></div><div><a href="/2022/12/29/react%E3%80%90RTK%20Query%E3%80%91/" title="ReactRTK Query"><img class="cover" src="https://w.wallhaven.cc/full/g7/wallhaven-g75r7d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-29</div><div class="title">ReactRTK Query</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NDQxMy8zMDg4NA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/gwlnigth/upic/main/img/myher.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mrs.G</div><div class="author-info__description">月亮不睡你不睡,你是秃头小宝贝</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">129</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/gwlnigth"><i class="fab fa-github"></i><span>我的主页</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/gwlnigth" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2423414358@qq.com" target="_blank" title="QQ邮箱"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">文章正在努力更新嗷~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">#目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81React-Hook-%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">一、React Hook 介绍与环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8create-react-app%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text">1、使用create-react-app创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81React-Hooks-%E7%BC%96%E5%86%99%E5%BD%A2%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="toc-number">2.2.</span> <span class="toc-text">2、React Hooks 编写形式对比</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E5%86%99%E6%B3%95"><span class="toc-number">2.2.0.0.0.1.</span> <span class="toc-text">原始写法:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#React-Hooks-%E5%86%99%E6%B3%95%EF%BC%9A"><span class="toc-number">2.2.0.0.0.2.</span> <span class="toc-text">React Hooks 写法：</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81useState"><span class="toc-number">3.</span> <span class="toc-text">二、useState</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81useState%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">1、useState的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-%E5%A3%B0%E6%98%8E%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">Ⅰ - 声明的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A1-%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E7%8A%B6%E6%80%81%E4%B8%AD%E7%9A%84%E5%80%BC"><span class="toc-number">3.1.2.</span> <span class="toc-text">Ⅱ - 如何读取状态中的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A2-%E5%A6%82%E4%BD%95%E6%94%B9%E5%8F%98State%E7%9A%84%E5%80%BC"><span class="toc-number">3.1.3.</span> <span class="toc-text">Ⅲ - 如何改变State的值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%A4%9A%E7%8A%B6%E6%80%81%E5%A3%B0%E6%98%8E%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.2.</span> <span class="toc-text">2、多状态声明的注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-%E4%B8%BE%E4%B8%AA%E9%94%99%E8%AF%AF%E5%86%99%E6%B3%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">Ⅰ - 举个错误写法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81useEffect"><span class="toc-number">4.</span> <span class="toc-text">三、useEffect</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81useEffect%E4%BB%A3%E6%9B%BF%E5%B8%B8%E7%94%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">1、useEffect代替常用生命周期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-%E7%94%A8Class%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%BA%E8%AE%A1%E6%95%B0%E5%99%A8%E5%A2%9E%E5%8A%A0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.1.</span> <span class="toc-text">Ⅰ - 用Class的方式为计数器增加生命周期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A1-%E7%94%A8useEffect%E5%87%BD%E6%95%B0%E6%9D%A5%E4%BB%A3%E6%9B%BF%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.2.</span> <span class="toc-text">Ⅱ - 用useEffect函数来代替生命周期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A2-useEffect%E4%B8%A4%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">4.1.3.</span> <span class="toc-text">Ⅲ - useEffect两个注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useEffect-%E5%AE%9E%E7%8E%B0-componentWillUnmount%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">2、useEffect 实现 componentWillUnmount生命周期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-useEffect%E8%A7%A3%E7%BB%91%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">Ⅰ - useEffect解绑副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E7%AE%80%E5%8D%95%E7%9A%84%E6%A0%97%E5%AD%90"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">a)  简单的栗子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E5%A4%8D%E6%9D%82%E7%9A%84%E6%A0%97%E5%AD%90"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">b)  复杂的栗子</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-%E8%BF%99%E9%87%8C%E4%B8%BA%E4%BA%86%E6%BC%94%E7%A4%BA%E7%94%A8useEffect%E6%9D%A5%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%BC%BCcomponentWillUnmount%E6%95%88%E6%9E%9C%EF%BC%8C%E5%85%88%E5%AE%89%E8%A3%85React-Router%E8%B7%AF%E7%94%B1"><span class="toc-number">4.2.1.2.1.</span> <span class="toc-text">① 这里为了演示用useEffect来实现类似componentWillUnmount效果，先安装React-Router路由</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E7%84%B6%E5%90%8E%E6%89%93%E5%BC%80Example-js%E6%96%87%E4%BB%B6-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-%EF%BC%8C%E8%BF%9B%E8%A1%8C%E6%94%B9%E5%86%99%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%85%88%E5%BC%95%E5%85%A5%E5%AF%B9%E5%BA%94%E7%9A%84React-Router%E7%BB%84%E4%BB%B6%E3%80%82"><span class="toc-number">4.2.1.2.2.</span> <span class="toc-text">② 然后打开Example.js文件(示例代码)，进行改写代码，先引入对应的React-Router组件。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD%E7%BC%96%E5%86%99%E4%B8%A4%E4%B8%AA%E6%96%B0%E7%BB%84%E4%BB%B6%EF%BC%8C%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%BB%84%E4%BB%B6%E9%83%BD%E9%9D%9E%E5%B8%B8%E7%9A%84%E7%AE%80%E5%8D%95%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E4%B8%8D%E5%8D%95%E7%8B%AC%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E6%96%87%E4%BB%B6%E6%9D%A5%E5%86%99%E4%BA%86%E3%80%82"><span class="toc-number">4.2.1.2.3.</span> <span class="toc-text">③ 在文件中编写两个新组件，因为这两个组件都非常的简单，所以就不单独建立一个新的文件来写了。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link"><span class="toc-number">4.2.1.2.4.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3-%E7%84%B6%E5%90%8E%E5%88%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%8B"><span class="toc-number">4.2.1.2.5.</span> <span class="toc-text">④ 然后到浏览器中查看一下</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81useEffect%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">3、useEffect的第二个参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90"><span class="toc-number">4.3.1.</span> <span class="toc-text">Ⅰ - 举个栗子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81useEffect-%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%89%A7%E2%BE%8F"><span class="toc-number">4.4.</span> <span class="toc-text">4、useEffect 的条件执⾏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%B8%85%E9%99%A4-effect"><span class="toc-number">4.5.</span> <span class="toc-text">5、清除 effect</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81useContext"><span class="toc-number">5.</span> <span class="toc-text">四、useContext</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81useContext-%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.1.</span> <span class="toc-text">1、useContext 介绍与代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useContext-%E6%8E%A5%E6%94%B6%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8F%98%E9%87%8F"><span class="toc-number">5.2.</span> <span class="toc-text">2、useContext 接收上下文变量</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81useReducer%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">五、useReducer介绍和简单使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81reducer%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.</span> <span class="toc-text">1、reducer到底是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useReducer%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">2、useReducer的使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81useReducer%E4%BB%A3%E6%9B%BFRedux%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">六、useReducer代替Redux小案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8useReducer"><span class="toc-number">7.1.</span> <span class="toc-text">1、为何使用useReducer</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Redux-%E6%AF%AB%E6%97%A0%E7%96%91%E9%97%AE%E6%98%AF%E4%BC%97%E5%A4%9A-React-%E9%A1%B9%E7%9B%AE%E9%A6%96%E9%80%89%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BD%86-Redux-%E6%9F%90%E4%BA%9B%E5%9C%B0%E6%96%B9%E7%9A%84%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E5%B9%B6%E4%B8%8D%E5%A5%BD%E3%80%82"><span class="toc-number">7.1.0.0.0.1.</span> <span class="toc-text">Redux 毫无疑问是众多 React 项目首选的状态管理方案，但 Redux 某些地方的开发体验并不好。</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useContext-useReducer-%E5%A6%82%E4%BD%95%E6%9B%BF%E4%BB%A3-redux-%EF%BC%9F%E5%8F%8A%E5%8F%AF%E8%A1%8C%E6%80%A7"><span class="toc-number">7.2.</span> <span class="toc-text">2、useContext + useReducer 如何替代 redux ？及可行性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.3.</span> <span class="toc-text">3、案例代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A0%E3%80%81%E5%BC%80%E5%A7%8B"><span class="toc-number">7.3.0.0.1.</span> <span class="toc-text">Ⅰ、开始</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A1%E3%80%81%E5%88%9B%E5%BB%BA%E9%A2%9C%E8%89%B2%E5%B1%95%E7%A4%BA%E7%BB%84%E4%BB%B6-ShowArea"><span class="toc-number">7.3.0.0.2.</span> <span class="toc-text">Ⅱ、创建颜色展示组件 ShowArea</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A2%E3%80%81%E5%88%9B%E5%BB%BA%E6%8C%89%E9%92%AE%E7%BB%84%E4%BB%B6-buttons"><span class="toc-number">7.3.0.0.3.</span> <span class="toc-text">Ⅲ、创建按钮组件 buttons</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A3%E3%80%81%E5%B0%86-ShowArea-%E5%92%8C-Buttons-%E5%AF%BC%E5%85%A5-index-js-%E7%AD%89%E4%BC%9A%E5%86%99%E5%87%BAcolor%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6%E5%90%8E%E5%B0%86%E4%BC%9A%E6%94%B9%E5%86%99"><span class="toc-number">7.3.0.0.4.</span> <span class="toc-text">Ⅳ、将 ShowArea 和 Buttons 导入 index.js(等会写出color状态组件后将会改写)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A4%E3%80%81%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6%E5%88%9B%E5%BB%BA%E7%BC%96%E5%86%99"><span class="toc-number">7.3.0.0.5.</span> <span class="toc-text">Ⅴ、状态管理组件创建编写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A5%E3%80%81%E5%BC%95%E5%85%A5%E7%8A%B6%E6%80%81"><span class="toc-number">7.3.0.0.6.</span> <span class="toc-text">Ⅵ、引入状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A6%E3%80%81%E8%8E%B7%E5%8F%96%E7%8A%B6%E6%80%81"><span class="toc-number">7.3.0.0.7.</span> <span class="toc-text">Ⅶ、获取状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A7%E3%80%81%E5%88%9B%E5%BB%BA-reducer"><span class="toc-number">7.3.0.0.8.</span> <span class="toc-text">Ⅷ、创建 reducer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%85%A8%E3%80%81%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81"><span class="toc-number">7.3.0.0.9.</span> <span class="toc-text">Ⅸ、更新状态</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">7.4.</span> <span class="toc-text">4、总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81useMemo%E4%BC%98%E5%8C%96React-Hooks%E7%A8%8B%E5%BA%8F%E6%80%A7%E8%83%BD"><span class="toc-number">8.</span> <span class="toc-text">七、useMemo优化React Hooks程序性能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%B1%95%E7%A4%BA%E6%A1%88%E4%BE%8B"><span class="toc-number">8.1.</span> <span class="toc-text">1、性能问题展示案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useMemo-%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD"><span class="toc-number">8.2.</span> <span class="toc-text">2、useMemo 优化性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91"><span class="toc-number">8.3.</span> <span class="toc-text">3、可能遇到的坑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%85%A0-%E4%BC%A0%E9%80%92%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BD%BF%E7%94%A8%E8%B5%8B%E5%80%BC%E8%A7%A3%E6%9E%84"><span class="toc-number">8.3.1.</span> <span class="toc-text">Ⅰ - 传递的第二个参数使用赋值解构</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">8.3.1.0.0.1.</span> <span class="toc-text">错误代码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%86%99%E6%B3%95"><span class="toc-number">8.3.1.0.0.2.</span> <span class="toc-text">正确的写法</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81useRef%E8%8E%B7%E5%8F%96DOM%E5%85%83%E7%B4%A0%E5%92%8C%E4%BF%9D%E5%AD%98%E5%8F%98%E9%87%8F"><span class="toc-number">9.</span> <span class="toc-text">八、useRef获取DOM元素和保存变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81useRef%E8%8E%B7%E5%8F%96DOM%E5%85%83%E7%B4%A0"><span class="toc-number">9.1.</span> <span class="toc-text">1、useRef获取DOM元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81useRef%E4%BF%9D%E5%AD%98%E6%99%AE%E9%80%9A%E5%8F%98%E9%87%8F"><span class="toc-number">9.2.</span> <span class="toc-text">2、useRef保存普通变量</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89Hooks%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F"><span class="toc-number">10.</span> <span class="toc-text">九、自定义Hooks函数获取窗口大小</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">10.1.</span> <span class="toc-text">1、编写自定义函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E7%BB%84%E4%BB%B6%E5%B9%B6%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.</span> <span class="toc-text">2、编写组件并使用自定义函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81React%E7%9A%84React-FC%E4%B8%8EReact-Component%E7%9A%84%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86"><span class="toc-number">11.</span> <span class="toc-text">十、React的React.FC与React.Component的初步认识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81React-FC-lt-gt"><span class="toc-number">11.1.</span> <span class="toc-text">1、React.FC&lt;&gt;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81class-xx-extends-React-Component"><span class="toc-number">11.2.</span> <span class="toc-text">2、class xx extends React.Component</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/react%E3%80%90styled-components%E7%9A%84%E4%BD%BF%E7%94%A8%E3%80%91/" title="ReactStyled-components"><img src="https://w.wallhaven.cc/full/rd/wallhaven-rdpgxj.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ReactStyled-components"/></a><div class="content"><a class="title" href="/2022/12/29/react%E3%80%90styled-components%E7%9A%84%E4%BD%BF%E7%94%A8%E3%80%91/" title="ReactStyled-components">ReactStyled-components</a><time datetime="2022-12-29T11:19:53.341Z" title="发表于 2022-12-29 19:19:53">2022-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/react%E3%80%90react%E4%B8%AD%E4%BD%BF%E7%94%A8ts%E3%80%91/" title="React中使用ts"><img src="https://w.wallhaven.cc/full/g7/wallhaven-g75r7d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React中使用ts"/></a><div class="content"><a class="title" href="/2022/12/29/react%E3%80%90react%E4%B8%AD%E4%BD%BF%E7%94%A8ts%E3%80%91/" title="React中使用ts">React中使用ts</a><time datetime="2022-12-29T11:19:53.333Z" title="发表于 2022-12-29 19:19:53">2022-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/react%E3%80%90RTK%20Query%E3%80%91/" title="ReactRTK Query"><img src="https://w.wallhaven.cc/full/g7/wallhaven-g75r7d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ReactRTK Query"/></a><div class="content"><a class="title" href="/2022/12/29/react%E3%80%90RTK%20Query%E3%80%91/" title="ReactRTK Query">ReactRTK Query</a><time datetime="2022-12-29T11:19:53.329Z" title="发表于 2022-12-29 19:19:53">2022-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/react%E3%80%90Redux%20Toolkit%E3%80%91/" title="ReactRedux Toolkit"><img src="https://w.wallhaven.cc/full/57/wallhaven-57mk71.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ReactRedux Toolkit"/></a><div class="content"><a class="title" href="/2022/12/29/react%E3%80%90Redux%20Toolkit%E3%80%91/" title="ReactRedux Toolkit">ReactRedux Toolkit</a><time datetime="2022-12-29T11:19:53.324Z" title="发表于 2022-12-29 19:19:53">2022-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/react%E3%80%90redux%E3%80%91/" title="ReactRedux"><img src="https://w.wallhaven.cc/full/28/wallhaven-28o9ym.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ReactRedux"/></a><div class="content"><a class="title" href="/2022/12/29/react%E3%80%90redux%E3%80%91/" title="ReactRedux">ReactRedux</a><time datetime="2022-12-29T11:19:53.319Z" title="发表于 2022-12-29 19:19:53">2022-12-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Mrs.G</div><div class="footer_custom_text">中国 | 在此<br> <a href="/"><img class="icp-icon" src="https://gitee.com/airgwl/upic/raw/master/img/peicoffic.svg"><span>备案号：未知</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (true) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":200,"height":180},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>